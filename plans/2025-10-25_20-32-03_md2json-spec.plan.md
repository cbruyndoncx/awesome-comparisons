# Plan: Create md2json TypeScript Spec

Document a Tessl spec for a TypeScript-based `md2json` converter that matches the behavior of the existing Python utility and integrates cleanly with the current build tooling.

## Tasks

- [x] Capture requirements from the existing Python `md2json` implementation.
  > **Bash** `{"command":["bash","-lc","sed -n '1,200p' md2json/md2json.py"],"workdir":"/home/cb/projects/github/ultimate/ultimate-comparison-framework"}`
  >
  > Reviewed the converterâ€™s main logic, argument parsing, and JSON generation strategy in [md2json/md2json.py](../md2json/md2json.py) lines 1-200 to capture behavior around file IO, markdown parsing, and legacy JSON structure.
  > ---
  > **Bash** `{"command":["bash","-lc","sed -n '200,320p' md2json/md2json.py"],"workdir":"/home/cb/projects/github/ultimate/ultimate-comparison-framework"}`
  >
  > Captured the remainder of [md2json/md2json.py](../md2json/md2json.py) covering positional argument fallbacks and `main` wiring, ensuring CLI compatibility requirements are documented.
- [x] Decide whether the replacement should be written in JavaScript or TypeScript and record the rationale.
  > **Bash** `{"command":["bash","-lc","cat package.json"],"workdir":"/home/cb/projects/github/ultimate/ultimate-comparison-framework"}`
  >
  > Verified that the project is already TypeScript-first (Angular 17 toolchain, `typescript` dev dependency, and Babel register for ES modules) via [package.json](../package.json), so targeting TypeScript keeps tooling consistent (type safety, aligns with existing build scripts) and offers smoother integration than plain JavaScript.
- [x] Use Tessl to author the new spec describing the TypeScript `md2json` converter.
  > **Bash** `{"command":["bash","-lc","mkdir -p specs/lib/md2json"],"workdir":"/home/cb/projects/github/ultimate-comparison-framework"}`
  >
  > Ensured the spec directory structure exists so the Tessl artifact can be written.
  > ---
  > **MCP** `tessl - create`
  > - spec: specs/lib/md2json/md2json.spec.md
  > - prompt:
  >   ```
  >   Create a Tessl spec for migrating the existing Python-based md2json converter into TypeScript so it fits the Ultimate Comparison Framework build chain. The TypeScript implementation should live under lib/md2json/ and expose both a reusable Md2Json class and a CLI entry point that Node can execute (so MD_TO_JSON_COMMAND can be set to `node ./lib/md2json/cli.js`).
  >
  >   Key behavior to capture:
  >   - Accepts arguments `--input`, `--tmp`, `--output`, `--level`, and `--pretty`, plus the legacy positional `input tmp output [level] [pretty]` fallback. Reject missing paths with a helpful error message and a non-zero exit code.
  >   - Walks the `input` directory, sorts *.md files alphabetically, and converts each into the legacy header/list JSON format used today. The first `#` line is the entry title. Text before the first `##` becomes a description block. Each `## Some Criterion` heading defines a criterion: the text under it becomes a `type: "text"` child (line breaks preserved, blank lines stripped), and list items that start with `-` become a nested `type: "list"` section with `item` children mirroring the Python structure. Stop consuming when another single-`#` header is encountered in the same file.
  >   - Skip files that cannot be parsed (no top-level header) but keep processing others; emit a warning for each skipped file.
  >   - Write each converted entry as JSON into the tmp directory mirroring the filename (`foo.md` -> `tmp/foo.json`), creating directories as needed. Aggregate all entries into a single JSON array written to `--output`. Honor `--pretty` by pretty-printing both tmp files and the aggregated output. The `--level` flag should be stored on the Md2Json instance for future use even if it does not currently affect the JSON payload.
  >   - Return a rejected promise / exit non-zero if any read/write operation fails, preserving stderr logs so gulp can surface them in tmp/error.log.
  >
  >   Document types for the JSON nodes, the Md2Json public API (constructor + dirToJson + convertMarkdownToJson helpers), and how the CLI wires argument parsing to the converter. The spec should live at specs/lib/md2json/md2json.spec.md.
  >   ```
  >
  > Generated the initial spec scaffold at [specs/lib/md2json/md2json.spec.md](../specs/lib/md2json/md2json.spec.md).
  > ---
  > **Bash** `{"command":["bash","-lc","cat specs/lib/md2json/md2json.spec.md"],"workdir":"/home/cb/projects/github/ultimate-comparison-framework"}`
  >
  > Reviewed the generated spec to confirm coverage of CLI arguments, JSON structure, and error handling expectations.
  > ---
  > **Edit** `apply_patch` (parameters omitted; contained full spec text)
  >
  > Updated [specs/lib/md2json/md2json.spec.md](../specs/lib/md2json/md2json.spec.md) to reference a TypeScript CLI file, describe the exact legacy JSON node structure (header/text/list/item), and clarify output formatting requirements so Tessl builds the correct TypeScript implementation.
