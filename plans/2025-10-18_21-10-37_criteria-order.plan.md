# Plan: Honor Criteria Order Metadata

Make the `order` property from the comparison configuration drive the sort order for search criteria, table columns, and details view tags.

## Tasks

- [x] Inspect current ordering flows for criteria in search, table, and details
  > **Bash** `rg "tableColumns" -n src/app`
  > Checked where table column metadata is used to understand current ordering control.
  > ---
  > **Bash** `sed -n '120,220p' src/app/components/comparison/configuration/configuration.service.ts`
  > Reviewed configuration loading and dispatch to identify where sorting could be introduced.
  > ---
  > **Bash** `rg "currentColumns" -n src/app/redux/uc.reducers.ts`
  > Located reducer routines responsible for column ordering in the store.
  > ---
  > **Bash** `sed -n '340,420p' src/app/redux/uc.reducers.ts`
  > Inspected `filterColumns` logic to see how column arrays get populated and maintained.
- [x] Apply order-based sorting when loading configuration data
  > **Apply Patch** `src/app/components/comparison/configuration/configuration.service.ts`
  > ```diff
  > +    private static parseOrder(order: any): number {
  > +        if (isNullOrUndefined(order) || order === '') {
  > +            return Number.POSITIVE_INFINITY;
  > +        }
  > +        const numericOrder = Number(order);
  > +        return Number.isFinite(numericOrder) ? numericOrder : Number.POSITIVE_INFINITY;
  > +    }
  > +
  > +    private static sortCriteriaByOrder(criteria: Array<Criteria>): Array<Criteria> {
  > +        return criteria
  > +            .map((crit, index) => ({
  > +                crit,
  > +                index,
  > +                order: ConfigurationService.parseOrder(crit.order)
  > +            }))
  > +            .sort((a, b) => {
  > +                if (a.order === b.order) {
  > +                    return a.index - b.index;
  > +                }
  > +                return a.order - b.order;
  > +            })
  > +            .map(item => item.crit);
  > +    }
  > @@
  > -            this.configuration.criteria = this.configuration.criteria.map(criteria => {
  > +            const processedCriteria = this.configuration.criteria.map(criteria => {
  > @@
  > -            this.criteria = this.configuration.criteria.filter(criteria => criteria.search);
  > +            this.configuration.criteria = ConfigurationService.sortCriteriaByOrder(processedCriteria);
  > +            this.tableColumns = this.configuration.criteria.filter(criteria => criteria.table).map(criteria => criteria.id);
  > +            this.criteria = this.configuration.criteria.filter(criteria => criteria.search);
  > ```
  > Introduced helpers to evaluate numeric order values, sorted criteria during load, and captured ordered table columns.
- [x] Update details component to respect ordered criteria list
  > **Apply Patch** `src/app/components/comparison/details/comparison.details.component.ts`
  > ```diff
  > -            criteriaDataMap.forEach((criteriaData, key) => {
  > -                const criteria = configuration.getCriteria(key);
  > -                if (criteria && criteria.id !== body.bodyRef && criteria.detail) {
  > -                    tags.push(criteriaData);
  > -                    types.push(criteria.type);
  > -                    if (criteriaData.type !== CriteriaTypes.RATING) {
  > -                        headers.push(criteria.name);
  > -                    } else {
  > -                        headers.push(criteria.name && criteria.name.length > 0 ? criteria.name : criteria.id);
  > -                    }
  > -                }
  > -            });
  > +            configuration.criteria.forEach(criteria => {
  > +                if (!criteria.detail || criteria.id === body.bodyRef) {
  > +                    return;
  > +                }
  > +                const criteriaData = criteriaDataMap.get(criteria.name) || criteriaDataMap.get(criteria.id);
  > +                if (!criteriaData) {
  > +                    return;
  > +                }
  > +                tags.push(criteriaData);
  > +                types.push(criteria.type);
  > +                if (criteriaData.type !== CriteriaTypes.RATING) {
  > +                    headers.push(criteria.name && criteria.name.length > 0 ? criteria.name : criteria.id);
  > +                } else {
  > +                    headers.push(criteria.name && criteria.name.length > 0 ? criteria.name : criteria.id);
  > +                }
  > +            });
  > ```
  > Replaced ad-hoc map iteration with configuration-driven ordering, ensuring the detail dialog follows the configured sequence.
- [x] Verify UI ordering via build/regeneration
  > **Bash** `MD_TO_JSON_COMMAND="python /home/cb/projects/github/ultimate/ultimate-comparison-framework/md2json/md2json.py" npm run build`
  > Build completed successfully after regenerating assets; ready to validate column/search/detail ordering in the UI.
