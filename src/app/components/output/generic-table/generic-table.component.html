<div class="group-controls" *ngIf="groups$ | async as groups">
    <ng-container *ngIf="groups.length > 0">
        <div class="group-controls__title">Grouping</div>
        <div class="group-controls__list">
            <button type="button"
                    class="group-control"
                    *ngFor="let group of groups; trackBy: trackGroup"
                    [class.group-control--expanded]="group.isExpanded"
                    [class.group-control--excluded]="group.isExcluded"
                    [disabled]="group.isExcluded"
                    [attr.aria-expanded]="group.isExpanded"
                    (click)="toggleGroup(group)">
                <span class="group-name">{{group.displayName}}</span>
                <span class="group-indicator" aria-hidden="true">{{groupIndicator(group)}}</span>
                <span class="sr-only">
                    {{ group.isExcluded ? 'Unavailable' : (group.isExpanded ? 'Collapse' : 'Expand') }}
                </span>
            </button>
        </div>
    </ng-container>
</div>

<table class="table-hover">
    <thead>
    <tr>
        <ng-template ngFor let-column [ngForOf]="columns" let-i="index">
            <th>
                <button (click)="orderClick($event, i)">
                    <iicon icon="keyboard-arrow-up" *ngIf="order[i]===-1; else elseif1">{{column}}</iicon>
                    <ng-template #elseif1>
                        <iicon icon="keyboard-arrow-down" *ngIf="order[i]===1; else elseif2">{{column}}</iicon>
                    </ng-template>
                    <ng-template #elseif2>
                        <iicon>{{column}}</iicon>
                    </ng-template>
                </button>
            </th>
        </ng-template>
        <th name="details" width="30px">
            <picon-button icon="settings" [showTooltip]="false" title="Settings"
                          (click)="settingsCallback.emit()"></picon-button>
        </th>
    </tr>
    </thead>
    <tbody>
    <ng-template ngFor let-item [ngForOf]="items" let-itemIndex="index">
        <tr>
            <ng-template ngFor let-entry [ngForOf]="item" let-i="index">
                <td *ngIf="types[i] === 'NAME_URL'">
                    <a class="anchored"
                       [href]="entry?.link || entry?.url || '#'"
                       target="_blank"
                       rel="noopener noreferrer">
                        {{entry?.text || 'â€”'}}
                    </a>
                </td>
                <td *ngIf="types[i] === 'TEXT'">
                    {{entry?.tableText || entry?.summaryText || entry?.text || entry?.content}}
                </td>
                <td *ngIf="types[i] ===  'LABEL' || types[i] === 'REPOSITORY'">
                    <ng-container *ngIf="entry?.labelArray?.length; else missingLabelBlock">
                        <ng-container *ngFor="let label of entry?.labelArray">
                            <ng-container *ngIf="label.tooltip?.text || label.tooltip?.html; else plainLabel">
                                <ptooltip [tooltip]="label.tooltip.text"
                                          [tooltipHtml]="label.tooltip.html" [position]="'n'">
                                    <div class="label mylabel {{label.clazz}}" [class.label--plain]="!labelColorsEnabled"
                                         [style.color]="labelColorsEnabled ? label.color : null"
                                         [style.background-color]="labelColorsEnabled ? label.backgroundColor : null"
                                         (click)="labelClick($event, label, i)">
                                        {{label.name}}
                                    </div>
                                </ptooltip>
                            </ng-container>
                            <ng-template #plainLabel>
                                <div class="label mylabel {{label.clazz}}" [class.label--plain]="!labelColorsEnabled"
                                     [style.color]="labelColorsEnabled ? label.color : null"
                                     [style.background-color]="labelColorsEnabled ? label.backgroundColor : null"
                                     (click)="labelClick($event, label, i)">
                                    {{label.name}}
                                </div>
                            </ng-template>
                        </ng-container>
                    </ng-container>
                    <ng-template #missingLabelBlock>
                        <div class="label mylabel label--missing">Missing</div>
                    </ng-template>
                    <div class="repository-links" *ngIf="entry?.type === 'REPOSITORY' && entry?.urlList?.length">
                        <a *ngFor="let link of entry.urlList" [href]="link" target="_blank" rel="noopener noreferrer">{{link}}</a>
                    </div>
                </td>

                <td *ngIf="types[i] === 'MARKDOWN'">
                    <ng-container *ngIf="entry?.tableText; else markdownHtml">
                        {{entry?.tableText}}
                    </ng-container>
                    <ng-template #markdownHtml>
                        <div [innerHtml]="entry?.html | sanitizeHtml"></div>
                    </ng-template>
                </td>
                <td *ngIf="types[i] === 'RATING'">
                    <iicon icon="star" *ngIf="entry?.rating !== undefined && entry?.rating !== null">{{entry.rating}}
                    </iicon>
                </td>
            </ng-template>
            <td>
                <picon-button icon="info" [showTooltip]="false" title="Details"
                              (click)="showDetails.emit(index[itemIndex])"></picon-button>
            </td>
        </tr>
    </ng-template>
    </tbody>
</table>
