<div class="pheader">
    <h2>{{data.name}}
        <ng-template ngFor let-label [ngForOf]="headerLabels">
            <ng-container *ngIf="label; else missingHeaderLabel">
                <ptooltip [tooltip]="label.tooltip.text"
                          [tooltipHtml]="prefixInternalLink(label.tooltip.html)" [position]="'s'">
                    <div class="label mylabel {{label.clazz}}" [class.label--plain]="!labelColorsEnabled"
                         [style.color]="labelColorsEnabled ? label.color : null"
                         [style.background-color]="labelColorsEnabled ? label.backgroundColor : null">
                        {{label.name}}
                    </div>
                </ptooltip>
            </ng-container>
        </ng-template>
        <ng-template #missingHeaderLabel>
            <div class="label mylabel label--missing">Missing</div>
        </ng-template>
        <small><a href="{{data.url}}" target="_blank">{{data.url}}</a></small>
    </h2>
</div>
<div class="grid-content">
    <pcard *ngIf="descriptionData" heading="{{bodyTitle}}" class="description">
        <div *ngIf="descriptionCriteria.type === 'MARKDOWN'" [innerHTML]="descriptionData.html | sanitizeHtml"
             class="description"></div>
        <div *ngIf="descriptionCriteria.type === 'TEXT'" [innerHTML]="descriptionData.text | sanitizeHtml"
             class="description"></div>
    </pcard>

    <ng-template #sectionContent let-section>
        <div class="card-content">
            <a *ngIf="section.type === 'NAME_URL' || section.type === 'URL'" class="anchored"
               href="{{section.data.link}}"
               target="_blank">{{section.data.text}}</a>

            <ng-container *ngIf="section.type === 'LABEL' || section.type === 'REPOSITORY'">
                <ng-container *ngIf="section.data?.labelArray?.length; else missingDetailLabel">
                    <ng-container *ngFor="let label of section.data?.labelArray">
                        <ptooltip *ngIf="!tooltipAsText"
                                  [tooltip]="label.tooltip.text"
                                  [tooltipHtml]="prefixInternalLink(label.tooltip.html)" [position]="'n'">
                            <div class="label mylabel {{label.clazz}}" [class.label--plain]="!labelColorsEnabled"
                                 [style.color]="labelColorsEnabled ? label.color : null"
                                 [style.background-color]="labelColorsEnabled ? label.backgroundColor : null">
                                {{label.name}}
                            </div>
                        </ptooltip>
                        <div *ngIf="tooltipAsText" class="tt-container">
                                <span class="label mylabel {{label.clazz}} tt-label" [class.label--plain]="!labelColorsEnabled"
                                      [style.color]="labelColorsEnabled ? label.color : null"
                                      [style.background-color]="labelColorsEnabled ? label.backgroundColor : null">
                                    {{label.name}}
                                </span>
                            <span class="tooltip-text tt-tooltip" [innerHtml]="label.tooltip.text|sanitizeHtml"></span>
                            <br *ngIf="label.tooltip.text && label.tooltip.html">
                            <span class="tooltip-text tt-tooltip" [innerHtml]="prefixInternalLink(label.tooltip.html|sanitizeHtml)"></span>
                        </div>
                    </ng-container>
                </ng-container>
                <ul *ngIf="section.data?.detailLabels?.length" class="detail-list">
                    <li *ngFor="let detail of section.data.detailLabels">{{detail.name}}</li>
                </ul>
                <div class="repository-links" *ngIf="section.data?.type === 'REPOSITORY' && section.data?.urlList?.length">
                    <a *ngFor="let link of section.data.urlList" [href]="link" target="_blank" rel="noopener noreferrer">{{link}}</a>
                </div>
            </ng-container>

            <span *ngIf="section.type === 'TEXT'">{{section.data.content}}</span>

            <span *ngIf="section.type === 'MARKDOWN'"
                  [innerHtml]="prefixInternalLink(section.data?.html | sanitizeHtml)"></span>

            <span *ngIf="section.type === 'RATING'" [innerHtml]="prefixInternalLink(section.data?.html | sanitizeHtml)"></span>
        </div>
    </ng-template>

    <ng-template #missingDetailLabel>
        <div class="label mylabel label--missing">Missing</div>
    </ng-template>

    <div class="grouped-sections" *ngIf="groupedSections.length">
        <pcard class="group-card" *ngFor="let group of groupedSections" [heading]="group.name">
            <div class="group-card__header" *ngIf="group.labelText">
                <span class="group-card__label" [attr.title]="group.labelTooltip || null">{{group.labelText}}</span>
            </div>
            <div class="group-card__sections">
                <div class="group-card__section" *ngFor="let section of group.sections">
                    <h4 class="group-card__section-title">{{section.criteria.name || section.criteria.id}}</h4>
                    <ng-container *ngTemplateOutlet="sectionContent; context: {$implicit: section}"></ng-container>
                </div>
            </div>
        </pcard>
    </div>

    <ng-container *ngFor="let section of ungroupedSections">
        <pcard [heading]="section.criteria.name || section.criteria.id">
            <ng-container *ngTemplateOutlet="sectionContent; context: {$implicit: section}"></ng-container>
        </pcard>
    </ng-container>

    <pcard heading="References" *ngIf="configurationService.configuration.citation?.length" class="description">
        <referencestable [changeNum]="configurationService.configuration.citation.length"
                         [citationMap]="configurationService.configuration.citation" [prefix]="'details-'"></referencestable>
    </pcard>
</div>
