<div class="focused-sheet__controls">
  <div class="focused-sheet__controls-left">
    <button type="button"
      class="focused-sheet__button"
      (click)="viewModeChange.emit(viewMode === 'sheet' ? 'table' : 'sheet')"
      [attr.aria-pressed]="viewMode === 'sheet'"
      [attr.title]="viewMode === 'sheet' ? 'Switch to standard table view' : 'Switch to focused sheet view'">
      <iicon icon="view-column"></iicon>
      <span class="sr-only">{{ viewMode === 'sheet' ? 'Standard view' : 'Focused sheet view' }}</span>
    </button>
    <button type="button"
      class="focused-sheet__button"
      (click)="toggleExpand.emit(!tableExpanded)"
      [attr.aria-pressed]="tableExpanded"
      [attr.title]="tableExpanded ? 'Collapse table view' : 'Expand table view'">
      <iicon [icon]="tableExpanded ? 'resize-small' : 'resize-full'"></iicon>
      <span class="sr-only">{{ tableExpanded ? 'Collapse table view' : 'Expand table view' }}</span>
    </button>
  </div>
  <button type="button"
    class="focused-sheet__print"
    (click)="triggerPrint()">
    <span aria-hidden="true">üñ®Ô∏è</span>
    <span>Print / Save as PDF</span>
  </button>
</div>

<div class="focused-sheet">
  <div class="focused-sheet__table-wrapper">
    <table class="focused-sheet__table">
      <thead>
        <tr>
          <th scope="col" class="focused-sheet__criteria-heading">Criteria</th>
          @for (header of elementHeaders; track header) {
            <th scope="col"
              class="focused-sheet__element-heading">
              <div class="focused-sheet__element-name">{{header.name}}</div>
              @if (header.description) {
                <div class="focused-sheet__element-description">{{header.description}}</div>
              }
              @if (header.url) {
                <a [href]="header.url" target="_blank" rel="noopener noreferrer">View</a>
              }
            </th>
          }
        </tr>
      </thead>
      <tbody>
        @for (row of sheetRows; track row) {
          <tr>
            <th scope="row" class="focused-sheet__criteria">{{row.label}}</th>
            @for (entry of row.values; track entry) {
              <td
                class="focused-sheet__value"
                [class.focused-sheet__value--label]="row.type === 'LABEL'"
                [class.focused-sheet__value--markdown]="row.type === 'MARKDOWN'">
                @switch (row.type) {
                  @case ('LABEL') {
                    @if (extractLabels(entry).length) {
                      @for (label of extractLabels(entry); track label) {
                        <div class="label mylabel {{label.clazz}}"
                          [class.label--plain]="!labelColorsEnabled"
                          [style.color]="labelColorsEnabled ? label.color : null"
                          [style.background-color]="labelColorsEnabled ? label.backgroundColor : null">
                          @if (label.displayHtml) {
                            <span [innerHtml]="label.displayHtml | sanitizeHtml"></span>
                          } @else {
                            {{labelDisplay(label)}}
                          }
                        </div>
                      }
                    } @else {
                      @if (shouldShowMissing(entry)) {
                        <span class="label mylabel label--missing">Missing</span>
                      }
                    }
                  }
                  @case ('NAME_URL') {
                    @if (entry?.link || entry?.url) {
                      <a [href]="entry?.link || entry?.url"
                        target="_blank"
                        rel="noopener noreferrer">
                        {{entry?.text || entry?.tableText || entry?.summaryText || entry?.link || entry?.url}}
                      </a>
                    } @else {
                      <span>{{entry?.tableText || entry?.summaryText || entry?.text || entry?.content}}</span>
                    }
                  }
                  @case ('URL') {
                    @if (entry?.url) {
                      <a [href]="entry?.url"
                        target="_blank"
                        rel="noopener noreferrer">
                        {{entry?.url}}
                      </a>
                    } @else {
                      <span>{{entry?.tableText || entry?.summaryText || entry?.text || entry?.content}}</span>
                    }
                  }
                  @case ('REPOSITORY') {
                    @if (entry?.urlList?.length) {
                      <div class="repository-links">
                        @for (link of entry?.urlList; track link) {
                          <a
                            [href]="link"
                            target="_blank"
                          rel="noopener noreferrer">{{link}}</a>
                        }
                      </div>
                    } @else {
                      <span>{{entry?.tableText || entry?.summaryText || entry?.text || entry?.content}}</span>
                    }
                  }
                  @case ('MARKDOWN') {
                    <div [innerHtml]="entry?.html | sanitizeHtml"></div>
                  }
                  @case ('RATING') {
                    @if (entry?.rating !== undefined && entry?.rating !== null) {
                      <span>‚òÖ {{entry?.rating}}</span>
                    }
                  }
                  @default {
                    <span>{{entry?.tableText || entry?.summaryText || entry?.text || entry?.content}}</span>
                  }
                }
                @if (!entry && !showMissingIndicators) {
                  <span class="focused-sheet__value--dash">‚Äî</span>
                }
              </td>
            }
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>
