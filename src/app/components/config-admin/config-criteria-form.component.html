<!-- GENERATED FROM SPEC - DO NOT EDIT -->
<!-- @generated with Tessl v0.28.0 from ../../../../specs/app/components/config-admin/config-criteria-form-component.html.spec.md -->
<!-- (spec:1ef4e0f8) (code:161b1765) -->

<section class="config-criteria" role="region" aria-label="Configuration editor">

  <!-- Sticky action bar -->
  <div class="config-criteria__actions">
    <button mat-raised-button color="accent" (click)="saveRequested.emit()" [disabled]="!isDirty"
      matTooltip="Save changes (Ctrl+S)">
      <mat-icon>save</mat-icon>
      Save
    </button>

    <button mat-raised-button (click)="revertRequested.emit()" [disabled]="!isDirty"
      matTooltip="Revert changes (Ctrl+Z)">
      <mat-icon>undo</mat-icon>
      Revert
    </button>

    <button mat-raised-button (click)="formatRequested.emit()" matTooltip="Format YAML (Ctrl+F)">
      <mat-icon>format_align_left</mat-icon>
      Format YAML
    </button>

    <div class="config-criteria__status">
      <span class="totals">Groups: {{ document?.criteriaGroups?.length || 0 }}</span>
      @if (isDirty) {
        <span class="dirty-indicator">‚óè</span>
      }
    </div>
  </div>

  <!-- Validation errors alert -->
  @if (validationErrors && validationErrors.length > 0) {
    <mat-expansion-panel class="validation-errors">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon color="warn">error</mat-icon>
          Validation Errors ({{ validationErrors.length }})
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ul>
        @for (error of validationErrors; track error) {
          <li>{{ error }}</li>
        }
      </ul>
    </mat-expansion-panel>
  }

  <!-- Main form content -->
  @if (document) {
    <div [formGroup]="documentForm">
      <!-- Criteria groups accordion -->
      <mat-accordion
        formArrayName="criteriaGroups"
        cdkDropList
        cdkDropListGroup
        (cdkDropListDropped)="reorderCriteriaGroups($event)">
        @for (group of criteriaGroupsArray.controls; track group; let i = $index) {
          <mat-expansion-panel
            [formGroupName]="i"
            cdkDrag
            hideToggle="true"
            #panel="matExpansionPanel">
            <!-- Group header -->
            <mat-expansion-panel-header class="criteria-group-header" [attr.aria-expanded]="panel.expanded">
              <mat-panel-title class="group-title">
                <span cdkDragHandle class="drag-handle">
                  <mat-icon>drag_indicator</mat-icon>
                </span>
                {{ group.get('name')?.value || 'Unnamed Group' }}
              </mat-panel-title>
              <mat-panel-description class="group-meta">
                Type: {{ group.get('type')?.value || 'N/A' }} | Order: {{ group.get('order')?.value || 0 }}
              </mat-panel-description>
              <div class="group-header__actions">
                <button
                  type="button"
                  mat-icon-button
                  color="primary"
                  class="group-toggle"
                  (click)="panel.toggle(); $event.stopPropagation()"
                  [attr.aria-label]="panel.expanded ? 'Collapse group' : 'Edit group'"
                  [matTooltip]="panel.expanded ? 'Collapse criteria group' : 'Edit criteria group'">
                  <mat-icon>{{ panel.expanded ? 'expand_less' : 'edit' }}</mat-icon>
                </button>
                <button
                  mat-icon-button
                  (click)="cloneCriteriaGroup(i); $event.stopPropagation()"
                  matTooltip="Clone criteria group"
                  aria-label="Clone criteria group">
                  <mat-icon>content_copy</mat-icon>
                </button>
                <button
                  mat-icon-button
                  color="warn"
                  (click)="removeCriteriaGroup(i); $event.stopPropagation()"
                  matTooltip="Delete criteria group"
                  aria-label="Delete criteria group">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </mat-expansion-panel-header>
            <!-- Group content -->
            <div class="criteria-group-content">
              <!-- Group form fields -->
              <div class="group-fields">
                <mat-form-field appearance="outline">
                  <mat-label>Name</mat-label>
                  <input matInput formControlName="name" placeholder="Group name">
                  @if (group.get('name')?.invalid && group.get('name')?.touched) {
                    <mat-error>
                      Name is required
                    </mat-error>
                  }
                </mat-form-field>
                <mat-form-field appearance="outline">
                  <mat-label>Type</mat-label>
                  <mat-select formControlName="type">
                    @for (type of groupTypeOptions; track type) {
                      <mat-option [value]="type">
                        {{ type }}
                      </mat-option>
                    }
                  </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline">
                  <mat-label>Order</mat-label>
                  <input matInput type="number" formControlName="order" placeholder="0">
                </mat-form-field>
              </div>
              <!-- Group toggles -->
              <div class="group-toggles">
                <mat-slide-toggle formControlName="search">Search</mat-slide-toggle>
                <mat-slide-toggle formControlName="table">Table</mat-slide-toggle>
                <mat-slide-toggle formControlName="detail">Detail</mat-slide-toggle>
              </div>
              <!-- Link existing criteria -->
              @if (linkableEntryOptions[i]?.length) {
                <div class="link-existing">
                  <mat-form-field appearance="outline">
                    <mat-label>Link existing criteria</mat-label>
                    <mat-select
                      [(ngModel)]="linkSelections[i]"
                      [ngModelOptions]="{ standalone: true }"
                      (selectionChange)="linkExistingCriteria(i, $event.value)">
                      <mat-option [value]="null">Select criteria</mat-option>
                      @for (option of linkableEntryOptions[i]; track option) {
                        <mat-option [value]="option.id">
                          {{ option.label }} (from {{ option.groupName }})
                        </mat-option>
                      }
                    </mat-select>
                  </mat-form-field>
                </div>
              }
              <!-- Criteria entries -->
              <div
                formArrayName="entries"
                cdkDropList
                [id]="getDropListId(i)"
                [cdkDropListData]="i"
                [cdkDropListConnectedTo]="getConnectedDropListIds(i)"
                (cdkDropListDropped)="reorderCriteriaEntries(i, $event)">
                @for (entry of getCriteriaEntriesArray(i).controls; track entry; let j = $index) {
                  <mat-card
                    [formGroupName]="j" class="criteria-entry" tabindex="0" cdkDrag>
                    <mat-card-header class="entry-header" [class.entry-header--collapsed]="!isEntryExpanded(i, j)">
                      <div class="entry-header__left">
                        <span cdkDragHandle class="drag-handle">
                          <mat-icon>drag_indicator</mat-icon>
                        </span>
                        <div class="entry-name">
                          {{ entry.get('name')?.value || 'Unnamed Entry' }}
                        </div>
                        <div class="entry-type">
                          Type: {{ entry.get('type')?.value || 'N/A' }}
                        </div>
                        <div class="entry-flags">
                          <span class="entry-flag" [class.entry-flag--active]="entry.get('search')?.value">Search</span>
                          <span class="entry-flag" [class.entry-flag--active]="entry.get('table')?.value">Table</span>
                          <span class="entry-flag" [class.entry-flag--active]="entry.get('detail')?.value">Detail</span>
                        </div>
                      </div>
                      <div class="entry-header__actions">
                        <button
                          mat-icon-button
                          color="primary"
                          (click)="toggleEntryExpansion(i, j)"
                          [matTooltip]="isEntryExpanded(i, j) ? 'Collapse criteria entry' : 'Edit criteria entry'">
                          <mat-icon>{{ isEntryExpanded(i, j) ? 'expand_less' : 'edit' }}</mat-icon>
                        </button>
                        <button
                          mat-icon-button
                          (click)="cloneCriteriaEntry(i, j)"
                          matTooltip="Clone criteria entry">
                          <mat-icon>content_copy</mat-icon>
                        </button>
                        <button
                          mat-icon-button
                          color="warn"
                          (click)="removeCriteriaEntry(i, j)"
                          matTooltip="Delete criteria entry">
                          <mat-icon>delete</mat-icon>
                        </button>
                      </div>
                    </mat-card-header>
                    @if (isEntryExpanded(i, j)) {
                      <mat-card-content>
                        <div class="entry-fields">
                          <mat-form-field appearance="outline">
                            <mat-label>ID</mat-label>
                            <input matInput formControlName="id" placeholder="Entry ID">
                            @if (entry.get('id')?.invalid && entry.get('id')?.touched) {
                              <mat-error>
                                ID is required
                              </mat-error>
                            }
                          </mat-form-field>
                          <mat-form-field appearance="outline">
                            <mat-label>Name</mat-label>
                            <input matInput formControlName="name" placeholder="Entry name">
                            @if (entry.get('name')?.invalid && entry.get('name')?.touched) {
                              <mat-error>
                                Name is required
                              </mat-error>
                            }
                          </mat-form-field>
                          <mat-form-field appearance="outline">
                            <mat-label>Type</mat-label>
                            <mat-select formControlName="type">
                              @for (type of allowedTypes; track type) {
                                <mat-option [value]="type">
                                  {{ type }}
                                </mat-option>
                              }
                            </mat-select>
                          </mat-form-field>
                          <mat-form-field appearance="outline">
                            <mat-label>Order</mat-label>
                            <input matInput type="number" formControlName="order" placeholder="0">
                          </mat-form-field>
                          <mat-form-field appearance="outline">
                            <mat-label>Placeholder</mat-label>
                            <input matInput formControlName="placeholder" placeholder="Placeholder text">
                          </mat-form-field>
                          <mat-form-field appearance="outline">
                            <mat-label>Description</mat-label>
                            <textarea matInput formControlName="description" placeholder="Entry description" rows="3"></textarea>
                          </mat-form-field>
                        </div>
                        <div class="entry-toggles">
                          <mat-slide-toggle formControlName="search">Search</mat-slide-toggle>
                          <mat-slide-toggle formControlName="table">Table</mat-slide-toggle>
                          <mat-slide-toggle formControlName="detail">Detail</mat-slide-toggle>
                          <mat-slide-toggle formControlName="andSearch">AND Search</mat-slide-toggle>
                          <mat-slide-toggle formControlName="rangeSearch">Range Search</mat-slide-toggle>
                        </div>
                        @if (entry.get('type')?.value === 'LABEL') {
                          @if (getLabelValuesForEntry(i, j); as labelValues) {
                            @if (labelValues.length) {
                              <div class="label-values">
                                <h4>Label Options</h4>
                                <div class="label-values__list">
                                  @for (value of labelValues; track value) {
                                    <span
                                      class="label-values__item"
                                      >
                                      <strong>{{ value.key }}</strong>
                                      @if (value.display) {
                                        <span class="label-values__display">
                                          {{ value.display }}
                                        </span>
                                      }
                                    </span>
                                  }
                                </div>
                              </div>
                            }
                          }
                          @if (isEntryExpanded(i, j)) {
                            <div
                              class="label-values-form"
                              formArrayName="labelValues"
                              >
                              <div class="label-values-form__header">
                                <h4>Label Values</h4>
                                <button
                                  mat-stroked-button
                                  color="primary"
                                  (click)="addLabelValue(i, j)">
                                  <mat-icon>add</mat-icon>
                                  Add Value
                                </button>
                              </div>
                              @if ((getLabelValuesFormArray(i, j)?.length || 0) === 0) {
                                <div
                                  class="label-values-form__empty"
                                  >
                                  <p>No label values defined</p>
                                </div>
                              }
                              @for (
                                valueCtrl of getLabelValuesFormArray(i, j)?.controls; track
                                valueCtrl; let k = $index) {
                                <div
                                  class="label-values-form__row"
                                  [formGroupName]="k">
                                  <mat-form-field appearance="outline">
                                    <mat-label>Key</mat-label>
                                    <input matInput formControlName="valueKey" placeholder="Value key">
                                  </mat-form-field>
                                  <mat-form-field appearance="outline">
                                    <mat-label>Display Text</mat-label>
                                    <input matInput formControlName="display" placeholder="Label display">
                                  </mat-form-field>
                                  <mat-form-field appearance="outline">
                                    <mat-label>Color</mat-label>
                                    <input matInput formControlName="color" placeholder="#rrggbb">
                                  </mat-form-field>
                                  <mat-form-field appearance="outline">
                                    <mat-label>Background</mat-label>
                                    <input matInput formControlName="backgroundColor" placeholder="#rrggbb">
                                  </mat-form-field>
                                  <button mat-icon-button color="warn" (click)="removeLabelValue(i, j, k)" matTooltip="Remove value">
                                    <mat-icon>delete</mat-icon>
                                  </button>
                                </div>
                              }
                            </div>
                          }
                        }
                      </mat-card-content>
                    }
                  </mat-card>
                }
                <!-- Add criteria entry button -->
                <button mat-raised-button (click)="addCriteriaEntry(i)" class="add-entry-btn">
                  <mat-icon>add</mat-icon>
                  Add Criteria Entry
                </button>
              </div>
              <!-- Value display overrides -->
              @if (group.get('id')?.value) {
                <div class="value-display-overrides">
                  <h4>Value Display Overrides</h4>
                  <table mat-table [dataSource]="getValueDisplayOverrides(group.get('id')?.value)" class="overrides-table">
                    <ng-container matColumnDef="value">
                      <th mat-header-cell *matHeaderCellDef>Value</th>
                      <td mat-cell *matCellDef="let override">{{ override.valueKey }}</td>
                    </ng-container>
                    <ng-container matColumnDef="emoji">
                      <th mat-header-cell *matHeaderCellDef>Emoji</th>
                      <td mat-cell *matCellDef="let override">
                        <input matInput [(ngModel)]="override.emoji" placeholder="üî•">
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="displayText">
                      <th mat-header-cell *matHeaderCellDef>Display Text</th>
                      <td mat-cell *matCellDef="let override">
                        <input matInput [(ngModel)]="override.displayText" placeholder="Display text">
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="actions">
                      <th mat-header-cell *matHeaderCellDef>Actions</th>
                      <td mat-cell *matCellDef="let override">
                        <button
                          mat-icon-button
                          (click)="updateValueDisplayOverride(group.get('id')?.value || '', override.valueKey, override.emoji, override.displayText)">
                          <mat-icon>save</mat-icon>
                        </button>
                        <button
                          mat-icon-button
                          color="warn"
                          (click)="removeValueDisplayOverride(group.get('id')?.value || '', override.valueKey)">
                          <mat-icon>delete</mat-icon>
                        </button>
                      </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="['value', 'emoji', 'displayText', 'actions']"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['value', 'emoji', 'displayText', 'actions'];"></tr>
                  </table>
                  <button mat-raised-button (click)="addValueDisplayOverride(group.get('id')?.value)" class="add-override-btn">
                    <mat-icon>add</mat-icon>
                    Add Override
                  </button>
                </div>
              }
            </div>
          </mat-expansion-panel>
        }
      </mat-accordion>
      <div class="add-group-footer">
        <button mat-raised-button color="primary" (click)="addCriteriaGroup()" matTooltip="Add new criteria group">
          <mat-icon>add</mat-icon>
          Add Group
        </button>
      </div>
    </div>
  } @else {
    <div class="empty-state">
      <mat-icon>description</mat-icon>
      <h3>No Document Loaded</h3>
      <p>Please load a configuration document to begin editing criteria.</p>
    </div>
  }

  <!-- Empty state template -->

</section>
